language: go
sudo: required
go:
  - 1.11
install:
  - go get github.com/gorilla/websocket
  - go get github.com/gomodule/redigo/redis
script:
  - mkdir reports
  - go get -u github.com/jstemmer/go-junit-report
  - go test -v | go-junit-report > reports/testcase.xml
  - go test -coverprofile=cover.out && go tool cover -html=cover.out -o reports/coverage.html
before_script:
  - docker-compose -f ci/docker-compose.yml up -d
services:
  - docker
deploy:
  provider: releases
  api_key:
    secure: $API_KEY_SECURE
  file_glob: true
  file: 'reports/*'
  skip_cleanup: true
  on:
    repo: stevenchiu7311/melody
    branches:
      only:
        - master
        - ci_test